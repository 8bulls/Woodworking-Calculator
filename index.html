.calc-btn.operation.active {
            background: #654321;
            transform: scale(0.95);
        }        function clearAll() {
            // This function is no longer used but kept for compatibility
            clearCalculator();
        }<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woodworking Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            font-family: Arial, sans-serif;
            background: #8B4513;
            color: #2F1B14;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        body {
            padding: 10px;
            background: linear-gradient(135deg, #8B4513, #DEB887);
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        h1 {
            text-align: center;
            color: #8B4513;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: #D2B48C;
            color: #8B4513;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .tab-btn.active {
            background: #8B4513;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .settings-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .settings-row label {
            font-weight: bold;
            min-width: 80px;
        }
        
        select, input {
            padding: 10px;
            border: 2px solid #D2B48C;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .wide-input {
            width: 80px !important;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .input-mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .input-group {
            display: flex;
            gap: 5px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .input-group input {
            width: 80px;
            text-align: center;
        }
        
        .input-group select {
            width: 100px;
        }
        
        .input-group label {
            font-weight: bold;
            margin-right: 5px;
        }
        
        .current-value {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #8B4513;
        }
        
        /* Calculator display styles */
        .calc-display {
            background: #2F1B14;
            color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .calc-equation {
            font-size: 16px;
            color: #D2B48C;
            min-height: 24px;
            margin-bottom: 5px;
        }
        
        .calc-result {
            font-size: 28px;
            font-weight: bold;
            text-align: right;
            min-height: 40px;
            word-break: break-all;
        }
        
        .calc-result.has-value {
            color: #4CAF50;
        }
        
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .calc-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            background: #D2B48C;
            color: #2F1B14;
        }
        
        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .calc-btn:active {
            transform: translateY(0);
        }
        
        .calc-btn.operation {
            background: #8B4513;
            color: white;
        }
        
        .calc-btn.equals {
            background: #4CAF50;
            color: white;
            grid-column: span 2;
        }
        
        .calc-btn.save {
            background: #2196F3;
            color: white;
        }
        
        .calc-btn.clear {
            background: #f44336;
            color: white;
        }
        
        .calc-btn.memory {
            background: #607D8B;
            color: white;
            font-size: 14px;
        }
        
        .memory-display {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 12px;
            color: #D2B48C;
        }
        
        .conversion-section {
            margin-bottom: 20px;
        }
        
        .conversion-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .preset-section {
            background: #f9f9f9;
            border: 2px solid #D2B48C;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .preset-section h4 {
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .preset-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .history-clickable {
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .history-clickable:hover {
            background: #e8f5e8;
        }
        
        .history-timestamp {
            font-size: 10px;
            color: #999;
            float: right;
        }
        
        .history-result {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .history-conversion {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #2196F3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .history-preset {
            background: #fff3e0;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #ff9800;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .history-equation {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            color: #2F1B14;
        }
        
        .history-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        /* Modal for calculations */
        .calc-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .calc-modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .calc-modal h3 {
            margin-bottom: 15px;
            color: #8B4513;
        }
        
        .calc-modal .input-group {
            margin-bottom: 15px;
        }
        
        .calc-modal .btn {
            margin-right: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .quick-cuts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .quick-cuts .btn {
            padding: 12px 8px;
            font-size: 14px;
        }
        
        .btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #8B4513;
            color: white;
        }
        
        .btn-primary:hover {
            background: #A0522D;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #D2B48C;
            color: #8B4513;
        }
        
        .btn-secondary:hover {
            background: #DEB887;
            transform: translateY(-2px);
        }
        
        .btn-operation {
            background: #D2B48C;
            color: #8B4513;
        }
        
        .btn-operation.active {
            background: #8B4513;
            color: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .manual-calc {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .history {
            max-height: 200px;
            overflow-y: auto;
            background: #f9f9f9;
            border: 2px solid #D2B48C;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .history-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-family: monospace;
            font-size: 14px;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .waste-section {
            margin-bottom: 20px;
        }
        
        .waste-section h3 {
            margin-bottom: 10px;
            color: #8B4513;
        }
        
        .board-input, .cut-input {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .results {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .cut-plan {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: monospace;
        }
        
        /* Visual diagram styles */
        .kerf-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .board-diagram {
            position: relative;
            width: 300px;
            height: 60px;
            background: linear-gradient(180deg, #D2691E 0%, #8B4513 100%);
            border: 2px solid #654321;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .mark-line {
            position: absolute;
            top: -10px;
            width: 2px;
            height: 80px;
            background: #ff0000;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .mark-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #ff0000;
            white-space: nowrap;
        }
        
        .kerf-area {
            position: absolute;
            top: 0;
            height: 100%;
            background: rgba(0,0,0,0.5);
            border: 1px dashed #fff;
        }
        
        .kerf-area.right {
            left: 50%;
            width: 10px;
        }
        
        .kerf-area.left {
            right: 50%;
            width: 10px;
        }
        
        .diagram-label {
            position: absolute;
            bottom: -20px;
            font-size: 11px;
            white-space: nowrap;
        }
        
        .left-piece {
            left: 10px;
        }
        
        .right-piece {
            right: 10px;
        }
        
        /* Cut result styles */
        .cut-results {
            background: #f5f5f5;
            border: 2px solid #8B4513;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .cut-results h4 {
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .mark-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .mark-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #8B4513;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mark-item .mark-number {
            font-weight: bold;
            color: #8B4513;
        }
        
        .mark-item .mark-value {
            font-family: monospace;
            font-size: 16px;
            font-weight: bold;
        }
        
        .piece-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            color: #2e7d32;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #f44336;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 3000;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 80%;
            text-align: center;
            font-weight: bold;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .notification.success {
            background: #4CAF50;
        }
        
        .notification.warning {
            background: #ff9800;
        }
        
        /* Edit modal styles */
        .edit-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .edit-modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .edit-modal h3 {
            margin-bottom: 15px;
            color: #8B4513;
        }
        
        .edit-modal .input-group {
            margin-bottom: 15px;
        }
        
        .edit-modal .btn {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Woodworking Calculator</h1>
        
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('calculator')">Calculator</button>
            <button class="tab-btn" onclick="switchTab('cutCalculator')">Cut Calculator</button>
            <button class="tab-btn" onclick="switchTab('optimizer')">Waste Optimizer</button>
        </div>
        
        <div style="text-align: right; margin-bottom: 15px;">
            <button class="btn btn-secondary" onclick="showHelp()" style="padding: 8px 12px; font-size: 14px;">❓ Help</button>
        </div>

        <!-- Calculator Tab -->
        <div id="calculator" class="tab-content active">
            <div class="settings-row">
                <label>Precision:</label>
                <select id="precision" onchange="updatePrecision('calculator')">
                    <option value="32">1/32"</option>
                    <option value="16" selected>1/16"</option>
                    <option value="8">1/8"</option>
                    <option value="4">1/4"</option>
                    <option value="2">1/2"</option>
                    <option value="1">1"</option>
                </select>
            </div>
            
            <div class="calc-display">
                <div class="memory-display" id="memoryIndicator"></div>
                <div class="calc-equation" id="calcEquation">&nbsp;</div>
                <div class="calc-result" id="calcResult">0"</div>
            </div>
            
            <div class="input-group">
                <label>Input 1:</label>
                <input type="number" id="feet1" placeholder="0" min="0" class="wide-input" onchange="updateCalculation()">
                <span>ft</span>
                <input type="number" id="inches1" placeholder="0" min="0" max="11" class="wide-input" onchange="updateCalculation()">
                <span>in</span>
                <select id="fraction1" style="width: 120px;" onchange="updateCalculation()">
                    <option value="0">0</option>
                </select>
            </div>
            
            <div class="calc-grid">
                <button class="calc-btn operation" onclick="setOperation('+')" id="addBtn">+</button>
                <button class="calc-btn operation" onclick="setOperation('-')" id="subBtn">−</button>
                <button class="calc-btn operation" onclick="setOperation('*')" id="mulBtn">×</button>
                <button class="calc-btn operation" onclick="setOperation('/')" id="divBtn">÷</button>
            </div>
            
            <div class="input-group" id="input2Group" style="display: none;">
                <label>Input 2:</label>
                <input type="number" id="feet2" placeholder="0" min="0" class="wide-input" onchange="updateCalculation()">
                <span>ft</span>
                <input type="number" id="inches2" placeholder="0" min="0" max="11" class="wide-input" onchange="updateCalculation()">
                <span>in</span>
                <select id="fraction2" style="width: 120px;" onchange="updateCalculation()">
                    <option value="0">0</option>
                </select>
            </div>
            
            <div class="calc-grid" style="margin-top: 15px;">
                <button class="calc-btn memory" onclick="memoryOperation('MC')">MC</button>
                <button class="calc-btn memory" onclick="memoryOperation('MR')">MR</button>
                <button class="calc-btn memory" onclick="memoryOperation('M+')">M+</button>
                <button class="calc-btn memory" onclick="memoryOperation('M-')">M−</button>
                <button class="calc-btn clear" onclick="clearCalculator()">Clear</button>
                <button class="calc-btn save" onclick="saveToHistory()">Save</button>
            </div>
            
            <div class="conversion-section">
                <h4 style="color: #8B4513; margin-bottom: 10px;">Quick Conversions</h4>
                <div class="conversion-grid">
                    <button class="btn btn-secondary" onclick="convertToDecimal()">→ Decimal</button>
                    <button class="btn btn-secondary" onclick="convertToFraction()">→ Fraction</button>
                    <button class="btn btn-secondary" onclick="convertToFeet()">→ Feet</button>
                    <button class="btn btn-secondary" onclick="convertToInches()">→ Inches</button>
                </div>
            </div>
            
            <div class="preset-section">
                <h4>Woodworking Calculations</h4>
                <div class="preset-grid">
                    <button class="btn btn-secondary" onclick="showBoardFootCalc()">Board Foot Calculator</button>
                    <button class="btn btn-secondary" onclick="calculateGoldenRatio()">Golden Ratio (1.618)</button>
                    <button class="btn btn-secondary" onclick="showSpacingCalc()">Equal Spacing Calculator</button>
                    <button class="btn btn-secondary" onclick="showAngleCalc()">Miter Angle Calculator</button>
                </div>
            </div>
            
            <div class="history" id="history">
                <!-- History will appear here -->
            </div>
        </div>
        
        <!-- Cut Calculator Tab -->
        <div id="cutCalculator" class="tab-content">
            <div class="settings-row">
                <label>Precision:</label>
                <select id="cutPrecision" onchange="updatePrecision('cut')">
                    <option value="32">1/32"</option>
                    <option value="16" selected>1/16"</option>
                    <option value="8">1/8"</option>
                    <option value="4">1/4"</option>
                    <option value="2">1/2"</option>
                    <option value="1">1"</option>
                </select>
            </div>
            
            <div class="settings-row">
                <label>
                    <input type="checkbox" id="cutKerfEnabled" checked onchange="toggleKerfDisplay()"> 
                    Kerf Compensation
                </label>
            </div>
            
            <div class="settings-row" id="cutKerfRow">
                <label>Kerf:</label>
                <select id="cutKerf">
                    <option value="0.0625">1/16"</option>
                    <option value="0.09375">3/32"</option>
                    <option value="0.125" selected>1/8"</option>
                    <option value="0.1875">3/16"</option>
                </select>
            </div>
            
            <div class="settings-row">
                <label>Cut Side of Mark:</label>
                <select id="cutSide" onchange="updateKerfDiagram()">
                    <option value="left">Left Side</option>
                    <option value="right">Right Side</option>
                </select>
            </div>
            
            <div class="kerf-diagram" id="kerfDiagram" style="display: none;">
                <div class="board-diagram">
                    <div class="mark-line"></div>
                    <div class="mark-label">Mark</div>
                    <div class="kerf-area" id="kerfArea"></div>
                    <div class="diagram-label left-piece">Left piece</div>
                    <div class="diagram-label right-piece">Right piece</div>
                </div>
            </div>
            
            <div class="input-group">
                <label>Input:</label>
                <input type="number" id="cutFeet" placeholder="0" min="0" class="wide-input">
                <span>ft</span>
                <input type="number" id="cutInches" placeholder="0" min="0" max="11" class="wide-input">
                <span>in</span>
                <select id="cutFraction" style="width: 120px;">
                    <option value="0">0</option>
                </select>
                <button class="btn btn-secondary" onclick="setCutValue()">Set</button>
            </div>
            
            <div class="current-value" id="cutCurrentValue">
                Enter measurement above
            </div>
            
            <div class="quick-cuts">
                <button class="btn btn-primary" onclick="quickCut(2)">Half</button>
                <button class="btn btn-primary" onclick="quickCut(3)">Thirds</button>
                <button class="btn btn-primary" onclick="quickCut(4)">Fourths</button>
                <button class="btn btn-primary" onclick="quickCut(5)">Fifths</button>
                <button class="btn btn-primary" onclick="quickCut(6)">Sixths</button>
                <button class="btn btn-primary" onclick="quickCut(8)">Eighths</button>
            </div>
            
            <div class="input-group" style="margin-bottom: 15px;">
                <label>Custom:</label>
                <input type="number" id="customPieces" placeholder="# pieces" min="2" max="20" class="wide-input">
                <button class="btn btn-primary" onclick="customCut()">Cut</button>
                <button class="btn btn-secondary" onclick="clearCut()">Clear</button>
            </div>
            
            <div class="history" id="cutHistory">
                <!-- Results will appear here -->
            </div>
        </div>

        <!-- Waste Optimizer Tab -->
        <div id="optimizer" class="tab-content">
            <div class="settings-row">
                <label>Precision:</label>
                <select id="optPrecision" onchange="updatePrecision('optimizer')">
                    <option value="32">1/32"</option>
                    <option value="16" selected>1/16"</option>
                    <option value="8">1/8"</option>
                    <option value="4">1/4"</option>
                    <option value="2">1/2"</option>
                    <option value="1">1"</option>
                </select>
            </div>
            
            <div class="settings-row">
                <label>
                    <input type="checkbox" id="optKerfEnabled" checked onchange="toggleKerfDisplay()"> 
                    Kerf Compensation
                </label>
            </div>
            
            <div class="settings-row" id="optKerfRow">
                <label>Kerf:</label>
                <select id="optKerf">
                    <option value="0.0625">1/16"</option>
                    <option value="0.09375">3/32"</option>
                    <option value="0.125" selected>1/8"</option>
                    <option value="0.1875">3/16"</option>
                </select>
            </div>
            
            <div class="waste-section">
                <h3>Available Boards</h3>
                <div class="board-input">
                    <input type="number" id="boardFeet" placeholder="0" min="0" class="wide-input">
                    <span>ft</span>
                    <input type="number" id="boardInches" placeholder="0" min="0" max="11" class="wide-input">
                    <span>in</span>
                    <select id="boardFraction" style="width: 120px;">
                        <option value="0">0</option>
                    </select>
                    <input type="number" id="boardQuantity" placeholder="1" min="1" class="wide-input">
                    <span>qty</span>
                    <button class="btn btn-secondary" onclick="addBoard()">Add</button>
                </div>
                <div id="boardsList"></div>
            </div>
            
            <div class="waste-section">
                <h3>Needed Cuts</h3>
                <div class="cut-input">
                    <input type="number" id="optCutFeet" placeholder="0" min="0" class="wide-input">
                    <span>ft</span>
                    <input type="number" id="optCutInches" placeholder="0" min="0" max="11" class="wide-input">
                    <span>in</span>
                    <select id="optCutFraction" style="width: 120px;">
                        <option value="0">0</option>
                    </select>
                    <input type="number" id="cutQuantity" placeholder="1" min="1" class="wide-input">
                    <span>qty</span>
                    <button class="btn btn-secondary" onclick="addCut()">Add</button>
                </div>
                <div id="cutsList"></div>
            </div>
            
            <button class="btn btn-primary" onclick="optimizeCuts()" style="width: 100%; margin-bottom: 15px;">Optimize Cuts</button>
            
            <div id="optimizationResults"></div>
        </div>
        
        <!-- Help Modal -->
        <div id="helpModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeHelp()">&times;</span>
                <h2>🪵 Woodworking Calculator Help</h2>
                
                <h3>Calculator Tab</h3>
                <p>Pure math calculations without kerf compensation. Perfect for:</p>
                <ul>
                    <li>Adding multiple board lengths</li>
                    <li>Calculating total project dimensions</li>
                    <li>General measurement conversions</li>
                </ul>
                <p><strong>Input modes:</strong> Toggle between fraction mode (feet/inches/fractions) and decimal mode (decimal inches).</p>
                
                <h3>Cut Calculator Tab</h3>
                <p>Cutting operations with automatic kerf compensation. Features:</p>
                <ul>
                    <li><strong>Quick Cuts:</strong> Cut boards in half, thirds, or fourths with automatic kerf compensation</li>
                    <li><strong>Cut Side of Mark:</strong> Choose if you cut on the left or right side of your pencil mark</li>
                    <li><strong>Kerf Settings:</strong> Select your blade width (1/16" to 3/16")</li>
                </ul>
                <p>The app calculates exactly where to mark your cuts so you get identical pieces after accounting for blade kerf.</p>
                
                <h3>Waste Optimizer Tab</h3>
                <p>Minimize lumber waste by optimizing how you cut multiple pieces:</p>
                <ul>
                    <li>Add all your available board lengths</li>
                    <li>Add all the pieces you need to cut (with quantities)</li>
                    <li>Get an optimized cutting plan showing which cuts to make on each board</li>
                    <li>Includes kerf compensation in the optimization</li>
                </ul>
                
                <h3>Precision Settings</h3>
                <p>Set your measuring precision (1/32" to 1") - all inputs and outputs will match your tape measure markings.</p>
                
                <h3>Tips</h3>
                <ul>
                    <li>Results automatically convert to feet and inches when appropriate</li>
                    <li>History tracks all your calculations for reference</li>
                    <li>All tabs work offline once loaded</li>
                    <li>Designed for use with work gloves in dusty shop conditions</li>
                </ul>
            </div>
        </div>
        
        <!-- Edit Modal -->
        <div id="editModal" class="edit-modal">
            <div class="edit-modal-content">
                <h3 id="editTitle">Edit Item</h3>
                <div id="editInputs">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveEdit()">Save</button>
                    <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-secondary" onclick="deleteEdit()" style="background: #cd5c5c; color: white; float: right;">Delete</button>
                </div>
            </div>
        </div>
        
        <!-- Calculation Modal -->
        <div id="calcModal" class="calc-modal">
            <div class="calc-modal-content">
                <span class="close" onclick="closeCalcModal()">&times;</span>
                <h3 id="calcModalTitle">Calculation</h3>
                <div id="calcModalInputs">
                    <!-- Dynamic content will be inserted here -->
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="executeModalCalc()">Calculate</button>
                    <button class="btn btn-secondary" onclick="closeCalcModal()">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Notification element -->
        <div id="notification" class="notification"></div>
    </div>

    <script>
        let currentValueInches = 0;
        let cutValueInches = 0;
        let currentOperation = null;
        let operationValue = 0;
        let history = [];
        let cutHistory = [];
        let boards = []; // Array of {length: number, quantity: number} objects
        let cuts = []; // Array of {length: number, id: unique_id}
        let inputMode = 'fraction';
        let editingItem = null; // Track what we're editing
        let cutIdCounter = 0; // For unique cut IDs
        let memoryValue = 0; // Calculator memory
        let value1 = 0; // First calculator value
        let value2 = 0; // Second calculator value
        
        // Notification system to replace alerts
        function showNotification(message, type = 'error') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';
            if (type === 'success') notification.classList.add('success');
            else if (type === 'warning') notification.classList.add('warning');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize fraction selectors with proper fraction display
        function updatePrecision(tabName = null) {
            let precision = 16;
            let fractionSelects = [];
            
            if (tabName === 'calculator' || !tabName) {
                precision = parseInt(document.getElementById('precision')?.value || 16);
                fractionSelects = ['fraction1', 'fraction2'];
            } else if (tabName === 'cut') {
                precision = parseInt(document.getElementById('cutPrecision')?.value || 16);
                fractionSelects = ['cutFraction'];
            } else if (tabName === 'optimizer') {
                precision = parseInt(document.getElementById('optPrecision')?.value || 16);
                fractionSelects = ['boardFraction', 'optCutFraction'];
            } else if (tabName === 'edit') {
                // Special case for edit modal - use optimizer precision
                precision = parseInt(document.getElementById('optPrecision')?.value || 16);
                fractionSelects = ['editFraction'];
            }
            
            fractionSelects.forEach(id => {
                const select = document.getElementById(id);
                if (!select) return;
                
                const currentValue = select.value; // Store current value
                select.innerHTML = '<option value="0">0</option>';
                
                for (let i = 1; i < precision; i++) {
                    const decimal = i / precision;
                    let displayText;
                    
                    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                    const divisor = gcd(i, precision);
                    const simplifiedNumerator = i / divisor;
                    const simplifiedDenominator = precision / divisor;
                    
                    if (simplifiedDenominator === precision) {
                        displayText = `${i}/${precision}`;
                    } else {
                        displayText = `${simplifiedNumerator}/${simplifiedDenominator} (${i}/${precision})`;
                    }
                    
                    select.innerHTML += `<option value="${decimal}">${displayText}</option>`;
                }
                
                // Restore value if it still exists
                if (currentValue && Array.from(select.options).some(opt => opt.value === currentValue)) {
                    select.value = currentValue;
                }
            });
            
            // Update calculator second input if it exists
            if (tabName === 'calculator') {
                const fraction2 = document.getElementById('fraction2');
                if (fraction2) {
                    const currentValue = fraction2.value;
                    fraction2.innerHTML = '<option value="0">0</option>';
                    for (let i = 1; i < precision; i++) {
                        const decimal = i / precision;
                        const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                        const divisor = gcd(i, precision);
                        const simplifiedNumerator = i / divisor;
                        const simplifiedDenominator = precision / divisor;
                        
                        let displayText;
                        if (simplifiedDenominator === precision) {
                            displayText = `${i}/${precision}`;
                        } else {
                            displayText = `${simplifiedNumerator}/${simplifiedDenominator} (${i}/${precision})`;
                        }
                        
                        fraction2.innerHTML += `<option value="${decimal}">${displayText}</option>`;
                    }
                    if (currentValue && Array.from(fraction2.options).some(opt => opt.value === currentValue)) {
                        fraction2.value = currentValue;
                    }
                }
            }
        }
        
        // Convert inches to feet/inches/fraction display
        function inchesToDisplay(totalInches, useTab = 'calculator') {
            let precision = 16;
            if (useTab === 'cut') {
                precision = parseInt(document.getElementById('cutPrecision')?.value || 16);
            } else if (useTab === 'opt') {
                precision = parseInt(document.getElementById('optPrecision')?.value || 16);
            } else {
                precision = parseInt(document.getElementById('precision')?.value || 16);
            }
            
            const roundedInches = Math.round(totalInches * precision) / precision;
            const feet = Math.floor(roundedInches / 12);
            const remainingInches = roundedInches - (feet * 12);
            const wholeInches = Math.floor(remainingInches);
            const fractionDecimal = remainingInches - wholeInches;
            
            let display = '';
            if (feet > 0) {
                display += feet + "'";
                if (wholeInches > 0 || fractionDecimal > 0) {
                    display += ' ';
                } else {
                    // Clean foot measurement - add 0"
                    display += ' 0"';
                    return display;
                }
            }
            
            if (wholeInches > 0 || (feet === 0 && fractionDecimal === 0)) {
                display += wholeInches;
                if (fractionDecimal > 0) {
                    display += ' ';
                }
            }
            
            if (fractionDecimal > 0) {
                const numerator = Math.round(fractionDecimal * precision);
                const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                const divisor = gcd(numerator, precision);
                display += (numerator / divisor) + '/' + (precision / divisor);
            }
            
            if (display === '') display = '0';
            display += '"';
            
            return display;
        }
        
        // Convert inches to feet, inches, and fraction parts
        function inchesToParts(totalInches) {
            const feet = Math.floor(totalInches / 12);
            const remainingInches = totalInches - (feet * 12);
            const wholeInches = Math.floor(remainingInches);
            const fractionDecimal = remainingInches - wholeInches;
            
            return {
                feet: feet,
                inches: wholeInches,
                fraction: fractionDecimal
            };
        }
        
        // Get total inches from inputs
        function getInputInches(feetId, inchesId, fractionId) {
            const feet = parseFloat(document.getElementById(feetId)?.value) || 0;
            const inches = parseFloat(document.getElementById(inchesId)?.value) || 0;
            const fraction = parseFloat(document.getElementById(fractionId)?.value) || 0;
            return (feet * 12) + inches + fraction;
        }
        
        function setCurrentValue() {
            currentValueInches = getInputInches('feet', 'inches', 'fraction');
            document.getElementById('currentValue').textContent = inchesToDisplay(currentValueInches);
        }
        
        // New calculator functions
        function setOperation(op) {
            currentOperation = op;
            document.getElementById('input2Group').style.display = 'flex';
            
            // Update button highlighting
            document.querySelectorAll('.calc-btn.operation').forEach(btn => btn.classList.remove('active'));
            const btnMap = {'+': 'addBtn', '-': 'subBtn', '*': 'mulBtn', '/': 'divBtn'};
            const activeBtn = document.getElementById(btnMap[op]);
            if (activeBtn) activeBtn.classList.add('active');
            
            updateCalculation();
        }
        
        function updateCalculation() {
            value1 = getInputInches('feet1', 'inches1', 'fraction1');
            value2 = getInputInches('feet2', 'inches2', 'fraction2');
            
            const equation = document.getElementById('calcEquation');
            const result = document.getElementById('calcResult');
            
            if (value1 > 0) {
                let equationText = inchesToDisplay(value1);
                
                if (currentOperation) {
                    equationText += ` ${currentOperation} `;
                    if (value2 > 0) {
                        equationText += inchesToDisplay(value2);
                        
                        // Auto-calculate if we have both values
                        let calcResult = 0;
                        switch (currentOperation) {
                            case '+': calcResult = value1 + value2; break;
                            case '-': calcResult = value1 - value2; break;
                            case '*': calcResult = value1 * value2; break;
                            case '/': calcResult = value2 !== 0 ? value1 / value2 : 0; break;
                        }
                        
                        if (calcResult !== 0) {
                            result.textContent = inchesToDisplay(calcResult);
                            result.classList.add('has-value');
                        }
                    }
                }
                equation.textContent = equationText;
            } else {
                equation.innerHTML = '&nbsp;';
                result.textContent = '0"';
                result.classList.remove('has-value');
            }
        }
        
        function calculateResult() {
            // No longer needed - replaced by saveToHistory
        }
        
        function saveToHistory() {
            if (!currentOperation || value1 === 0) {
                if (value1 > 0) {
                    // Just save the current value
                    addToCalcHistory({
                        equation: inchesToDisplay(value1),
                        result: value1,
                        timestamp: new Date().toLocaleTimeString(),
                        type: 'value'
                    });
                }
                return;
            }
            
            let result = 0;
            switch (currentOperation) {
                case '+': result = value1 + value2; break;
                case '-': result = value1 - value2; break;
                case '*': result = value1 * value2; break;
                case '/': 
                    if (value2 === 0) {
                        showNotification('Cannot divide by zero');
                        return;
                    }
                    result = value1 / value2;
                    break;
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const historyEntry = {
                equation: `${inchesToDisplay(value1)} ${currentOperation} ${inchesToDisplay(value2)} = ${inchesToDisplay(result)}`,
                result: result,
                timestamp: timestamp,
                type: 'calculation'
            };
            
            addToCalcHistory(historyEntry);
            
            // Set result as new value1 for chaining calculations
            const parts = inchesToParts(result);
            document.getElementById('feet1').value = parts.feet || '';
            document.getElementById('inches1').value = parts.inches || '';
            document.getElementById('fraction1').value = parts.fraction || 0;
            
            // Clear second input
            clearInput2();
            currentOperation = null;
            document.getElementById('input2Group').style.display = 'none';
            document.querySelectorAll('.calc-btn.operation').forEach(btn => btn.classList.remove('active'));
            
            updateCalculation();
        }
        
        function clearCalculator() {
            document.getElementById('feet1').value = '';
            document.getElementById('inches1').value = '';
            document.getElementById('fraction1').value = '0';
            clearInput2();
            currentOperation = null;
            value1 = 0;
            value2 = 0;
            document.getElementById('input2Group').style.display = 'none';
            document.querySelectorAll('.calc-btn.operation').forEach(btn => btn.classList.remove('active'));
            updateCalculation();
        }
        
        function clearInput2() {
            document.getElementById('feet2').value = '';
            document.getElementById('inches2').value = '';
            document.getElementById('fraction2').value = '0';
        }
        
        function memoryOperation(op) {
            const currentResult = value1 || 0;
            
            switch(op) {
                case 'MC': // Memory Clear
                    memoryValue = 0;
                    break;
                case 'MR': // Memory Recall
                    if (memoryValue !== 0) {
                        const parts = inchesToParts(memoryValue);
                        document.getElementById('feet1').value = parts.feet || '';
                        document.getElementById('inches1').value = parts.inches || '';
                        document.getElementById('fraction1').value = parts.fraction || 0;
                        updateCalculation();
                    }
                    break;
                case 'M+': // Memory Add
                    memoryValue += currentResult;
                    break;
                case 'M-': // Memory Subtract
                    memoryValue -= currentResult;
                    break;
            }
            
            // Update memory indicator
            const indicator = document.getElementById('memoryIndicator');
            if (memoryValue !== 0) {
                indicator.textContent = `M: ${inchesToDisplay(memoryValue)}`;
            } else {
                indicator.textContent = '';
            }
        }
        
        function addToCalcHistory(entry) {
            const historyDiv = document.getElementById('history');
            if (!historyDiv) return;
            
            const historyItem = document.createElement('div');
            
            // Style based on type
            if (entry.type === 'conversion') {
                historyItem.className = 'history-conversion history-clickable';
                historyItem.innerHTML = `
                    <div class="history-label">Conversion</div>
                    <div class="history-equation">${entry.equation}</div>
                    <span class="history-timestamp">${entry.timestamp}</span>
                `;
            } else if (entry.type === 'preset') {
                historyItem.className = 'history-preset';
                historyItem.innerHTML = `
                    <div class="history-label">${entry.label || 'Calculation'}</div>
                    <div class="history-equation">${entry.equation}</div>
                    <span class="history-timestamp">${entry.timestamp}</span>
                `;
            } else {
                historyItem.className = 'history-result history-clickable';
                historyItem.innerHTML = `
                    <div class="history-equation">${entry.equation}</div>
                    <span class="history-timestamp">${entry.timestamp}</span>
                `;
            }
            
            // Make clickable if it has a result
            if (entry.result !== undefined) {
                historyItem.onclick = () => {
                    const parts = inchesToParts(entry.result);
                    document.getElementById('feet1').value = parts.feet || '';
                    document.getElementById('inches1').value = parts.inches || '';
                    document.getElementById('fraction1').value = parts.fraction || 0;
                    updateCalculation();
                };
            }
            
            historyDiv.insertBefore(historyItem, historyDiv.firstChild);
            
            // Keep only last 15 entries
            while (historyDiv.children.length > 15) {
                historyDiv.removeChild(historyDiv.lastChild);
            }
        }
        
        // Conversion functions
        function convertToDecimal() {
            const inches = value1 || 0;
            if (inches === 0) {
                showNotification('Enter a value first');
                return;
            }
            addToCalcHistory({
                equation: `${inchesToDisplay(inches)} = ${inches.toFixed(4)}"`,
                result: inches,
                timestamp: new Date().toLocaleTimeString(),
                type: 'conversion'
            });
        }
        
        function convertToFraction() {
            const inches = value1 || 0;
            if (inches === 0) {
                showNotification('Enter a value first');
                return;
            }
            addToCalcHistory({
                equation: `${inches.toFixed(4)}" = ${inchesToDisplay(inches)}`,
                result: inches,
                timestamp: new Date().toLocaleTimeString(),
                type: 'conversion'
            });
        }
        
        function convertToFeet() {
            const inches = value1 || 0;
            if (inches === 0) {
                showNotification('Enter a value first');
                return;
            }
            const feet = inches / 12;
            addToCalcHistory({
                equation: `${inchesToDisplay(inches)} = ${feet.toFixed(4)} feet`,
                result: inches,
                timestamp: new Date().toLocaleTimeString(),
                type: 'conversion'
            });
        }
        
        function convertToInches() {
            const inches = value1 || 0;
            if (inches === 0) {
                showNotification('Enter a value first');
                return;
            }
            addToCalcHistory({
                equation: `${inchesToDisplay(inches)} = ${inches.toFixed(4)} inches`,
                result: inches,
                timestamp: new Date().toLocaleTimeString(),
                type: 'conversion'
            });
        }
        
        // Preset calculations with modal
        let currentModalCalc = null;
        
        function showBoardFootCalc() {
            currentModalCalc = 'boardfoot';
            const modal = document.getElementById('calcModal');
            const title = document.getElementById('calcModalTitle');
            const inputs = document.getElementById('calcModalInputs');
            
            title.textContent = 'Board Foot Calculator';
            inputs.innerHTML = `
                <div class="input-group">
                    <label>Thickness (inches):</label>
                    <input type="number" id="modalThickness" step="0.25" class="wide-input" placeholder="1">
                </div>
                <div class="input-group">
                    <label>Width (inches):</label>
                    <input type="number" id="modalWidth" step="0.25" class="wide-input" placeholder="6">
                </div>
                <div class="input-group">
                    <label>Length (feet):</label>
                    <input type="number" id="modalLength" step="0.5" class="wide-input" placeholder="8">
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function calculateGoldenRatio() {
            const inches = value1 || 0;
            if (inches === 0) {
                showNotification('Enter a value first');
                return;
            }
            
            const golden = 1.618033988749895;
            const result = inches * golden;
            
            addToCalcHistory({
                equation: `${inchesToDisplay(inches)} × φ (1.618) = ${inchesToDisplay(result)}`,
                result: result,
                timestamp: new Date().toLocaleTimeString(),
                type: 'preset',
                label: 'Golden Ratio'
            });
            
            // Set result as new value1
            const parts = inchesToParts(result);
            document.getElementById('feet1').value = parts.feet || '';
            document.getElementById('inches1').value = parts.inches || '';
            document.getElementById('fraction1').value = parts.fraction || 0;
            updateCalculation();
        }
        
        function showSpacingCalc() {
            const totalLength = value1 || 0;
            if (totalLength === 0) {
                showNotification('Enter total length first');
                return;
            }
            
            currentModalCalc = 'spacing';
            const modal = document.getElementById('calcModal');
            const title = document.getElementById('calcModalTitle');
            const inputs = document.getElementById('calcModalInputs');
            
            title.textContent = 'Equal Spacing Calculator';
            inputs.innerHTML = `
                <div style="margin-bottom: 10px;">Total length: <strong>${inchesToDisplay(totalLength)}</strong></div>
                <div class="input-group">
                    <label>Number of spaces:</label>
                    <input type="number" id="modalSpaces" min="2" class="wide-input" placeholder="4">
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function showAngleCalc() {
            currentModalCalc = 'angle';
            const modal = document.getElementById('calcModal');
            const title = document.getElementById('calcModalTitle');
            const inputs = document.getElementById('calcModalInputs');
            
            title.textContent = 'Miter & Angle Calculator';
            inputs.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: bold;">Calculator Type:</label>
                    <div style="margin-top: 10px;">
                        <label style="display: block; margin-bottom: 8px;">
                            <input type="radio" name="calcType" value="polygon" checked onchange="updateAngleCalcType()">
                            Polygon (equal-sided shape)
                        </label>
                        <label style="display: block;">
                            <input type="radio" name="calcType" value="single" onchange="updateAngleCalcType()">
                            Single angle cut
                        </label>
                    </div>
                </div>
                
                <div id="polygonInputs">
                    <div class="input-group">
                        <label>Number of sides:</label>
                        <input type="number" id="modalSides" min="3" class="wide-input" placeholder="8">
                    </div>
                    <p style="font-size: 12px; color: #666;">Examples: 4 = square, 6 = hexagon, 8 = octagon</p>
                </div>
                
                <div id="singleAngleInputs" style="display: none;">
                    <div class="input-group">
                        <label>Miter angle (degrees):</label>
                        <input type="number" id="modalAngle" step="0.5" class="wide-input" placeholder="45">
                    </div>
                    <div class="input-group">
                        <label>Board width:</label>
                        <input type="number" id="modalBoardWidth" step="0.0625" class="wide-input" placeholder="3.5">
                        <span>inches</span>
                    </div>
                    <div class="input-group">
                        <label>Known side:</label>
                        <select id="modalKnownSide" onchange="updateAngleLabels()">
                            <option value="long">Long side (back)</option>
                            <option value="short">Short side (front)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label id="knownLengthLabel">Long side length:</label>
                        <input type="number" id="modalKnownLength" step="0.0625" class="wide-input" placeholder="12">
                        <span>inches</span>
                    </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <svg width="250" height="120" viewBox="0 0 250 120">
                            <!-- Board outline -->
                            <rect x="30" y="30" width="180" height="50" fill="#D2691E" stroke="#8B4513" stroke-width="2"/>
                            <!-- Miter cut line -->
                            <line x1="150" y1="30" x2="210" y2="80" stroke="#FFD700" stroke-width="3"/>
                            <line x1="152" y1="30" x2="212" y2="80" stroke="#000" stroke-width="1" stroke-dasharray="3,3"/>
                            <!-- Dimension lines -->
                            <line x1="30" y1="20" x2="150" y2="20" stroke="#333" stroke-width="1"/>
                            <line x1="30" y1="20" x2="30" y2="25" stroke="#333" stroke-width="1"/>
                            <line x1="150" y1="20" x2="150" y2="25" stroke="#333" stroke-width="1"/>
                            <line x1="30" y1="90" x2="210" y2="90" stroke="#333" stroke-width="1"/>
                            <line x1="30" y1="85" x2="30" y2="90" stroke="#333" stroke-width="1"/>
                            <line x1="210" y1="85" x2="210" y2="90" stroke="#333" stroke-width="1"/>
                            <!-- Width indicator -->
                            <line x1="220" y1="30" x2="220" y2="80" stroke="#666" stroke-width="1"/>
                            <line x1="215" y1="30" x2="220" y2="30" stroke="#666" stroke-width="1"/>
                            <line x1="215" y1="80" x2="220" y2="80" stroke="#666" stroke-width="1"/>
                            <!-- Labels -->
                            <text x="90" y="15" text-anchor="middle" font-size="11" fill="#333">Short (front)</text>
                            <text x="120" y="105" text-anchor="middle" font-size="11" fill="#333">Long (back)</text>
                            <text x="180" y="60" text-anchor="middle" font-size="10" fill="#000">Cut</text>
                            <text x="235" y="58" text-anchor="middle" font-size="9" fill="#666">Width</text>
                        </svg>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }
        
        function updateAngleCalcType() {
            const calcType = document.querySelector('input[name="calcType"]:checked').value;
            document.getElementById('polygonInputs').style.display = calcType === 'polygon' ? 'block' : 'none';
            document.getElementById('singleAngleInputs').style.display = calcType === 'single' ? 'block' : 'none';
        }
        
        function updateAngleLabels() {
            const knownSide = document.getElementById('modalKnownSide').value;
            const label = document.getElementById('knownLengthLabel');
            label.textContent = knownSide === 'long' ? 'Long side length:' : 'Short side length:';
        }
        
        function closeCalcModal() {
            document.getElementById('calcModal').style.display = 'none';
            currentModalCalc = null;
        }
        
        function executeModalCalc() {
            if (currentModalCalc === 'boardfoot') {
                const thickness = parseFloat(document.getElementById('modalThickness')?.value) || 0;
                const width = parseFloat(document.getElementById('modalWidth')?.value) || 0;
                const length = parseFloat(document.getElementById('modalLength')?.value) || 0;
                
                if (thickness && width && length) {
                    const boardFeet = (thickness * width * length) / 12;
                    addToCalcHistory({
                        equation: `Board Feet: ${thickness}" × ${width}" × ${length}' = ${boardFeet.toFixed(2)} BF`,
                        result: boardFeet * 12, // Convert to inches for consistency
                        timestamp: new Date().toLocaleTimeString(),
                        type: 'preset',
                        label: 'Board Feet'
                    });
                    closeCalcModal();
                } else {
                    showNotification('Please fill in all fields');
                }
            } else if (currentModalCalc === 'spacing') {
                const spaces = parseInt(document.getElementById('modalSpaces')?.value) || 0;
                if (spaces > 0) {
                    const spacing = value1 / spaces;
                    addToCalcHistory({
                        equation: `${inchesToDisplay(value1)} ÷ ${spaces} spaces = ${inchesToDisplay(spacing)} each`,
                        result: spacing,
                        timestamp: new Date().toLocaleTimeString(),
                        type: 'preset',
                        label: 'Equal Spacing'
                    });
                    closeCalcModal();
                } else {
                    showNotification('Please enter number of spaces');
                }
            } else if (currentModalCalc === 'angle') {
                const calcType = document.querySelector('input[name="calcType"]:checked').value;
                
                if (calcType === 'polygon') {
                    const sides = parseInt(document.getElementById('modalSides')?.value) || 0;
                    if (sides > 2) {
                        const miterAngle = 180 / sides;
                        const sawAngle = 90 - miterAngle;
                        addToCalcHistory({
                            equation: `${sides}-sided: Miter ${miterAngle}°, Saw ${sawAngle}°`,
                            result: miterAngle,
                            timestamp: new Date().toLocaleTimeString(),
                            type: 'preset',
                            label: 'Polygon Angles'
                        });
                        closeCalcModal();
                    } else {
                        showNotification('Please enter valid number of sides');
                    }
                } else {
                    // Single angle calculation
                    const angle = parseFloat(document.getElementById('modalAngle')?.value) || 0;
                    const boardWidth = parseFloat(document.getElementById('modalBoardWidth')?.value) || 0;
                    const knownSide = document.getElementById('modalKnownSide').value;
                    const knownLength = parseFloat(document.getElementById('modalKnownLength')?.value) || 0;
                    
                    if (angle > 0 && angle < 90 && boardWidth > 0 && knownLength > 0) {
                        const angleRad = (angle * Math.PI) / 180;
                        let longSide, shortSide;
                        
                        // For a miter cut across a board:
                        // The difference between long and short sides = board width / tan(angle)
                        const difference = boardWidth / Math.tan(angleRad);
                        
                        if (knownSide === 'long') {
                            longSide = knownLength;
                            shortSide = longSide - difference;
                            
                            if (shortSide <= 0) {
                                showNotification('This cut would result in no material on the short side');
                                return;
                            }
                        } else {
                            shortSide = knownLength;
                            longSide = shortSide + difference;
                        }
                        
                        addToCalcHistory({
                            equation: `${angle}° miter on ${boardWidth}" board: Long ${inchesToDisplay(longSide)}, Short ${inchesToDisplay(shortSide)} (Δ ${inchesToDisplay(difference)})`,
                            result: knownSide === 'long' ? shortSide : longSide,
                            timestamp: new Date().toLocaleTimeString(),
                            type: 'preset',
                            label: 'Miter Cut'
                        });
                        
                        // Set the calculated value as new input
                        const parts = inchesToParts(knownSide === 'long' ? shortSide : longSide);
                        document.getElementById('feet1').value = parts.feet || '';
                        document.getElementById('inches1').value = parts.inches || '';
                        document.getElementById('fraction1').value = parts.fraction || 0;
                        updateCalculation();
                        
                        closeCalcModal();
                    } else {
                        showNotification('Please enter valid angle (0-90°), board width, and length');
                    }
                }
            }
        }
        
        function setCutValue() {
            cutValueInches = getInputInches('cutFeet', 'cutInches', 'cutFraction');
            document.getElementById('cutCurrentValue').textContent = inchesToDisplay(cutValueInches, 'cut');
        }
        
        function toggleInputMode() {
            inputMode = inputMode === 'fraction' ? 'decimal' : 'fraction';
            const fractionInputs = document.getElementById('fractionInputs');
            const decimalInputs = document.getElementById('decimalInputs');
            const toggleBtn = document.getElementById('modeToggle');
            
            if (inputMode === 'fraction') {
                fractionInputs.style.display = 'flex';
                decimalInputs.style.display = 'none';
                toggleBtn.textContent = 'Decimal Mode';
            } else {
                fractionInputs.style.display = 'none';
                decimalInputs.style.display = 'flex';
                toggleBtn.textContent = 'Fraction Mode';
            }
        }
        
        function getOperationValue() {
            if (inputMode === 'fraction') {
                return getInputInches('opFeet', 'opInches', 'opFraction');
            } else {
                return parseFloat(document.getElementById('operationValue')?.value) || 0;
            }
        }
        
        function quickCut(pieces) {
            if (cutValueInches <= 0) {
                showNotification('Please set a measurement first');
                return;
            }
            
            const kerfEnabled = document.getElementById('cutKerfEnabled')?.checked;
            const kerf = kerfEnabled ? parseFloat(document.getElementById('cutKerf')?.value || 0.125) : 0;
            const cutSide = document.getElementById('cutSide')?.value || 'left';
            const totalKerf = kerf * (pieces - 1);
            const pieceLength = (cutValueInches - totalKerf) / pieces;
            
            let results = [];
            let currentPos = 0;
            
            for (let i = 0; i < pieces - 1; i++) {
                // Calculate where each piece ends
                currentPos += pieceLength;
                
                // Adjust mark position based on cut side
                let markPosition = currentPos;
                if (kerfEnabled && cutSide === 'left') {
                    // If cutting on left side of mark, add kerf to mark position
                    markPosition += kerf;
                }
                // If cutting on right side, mark position stays at piece end
                
                results.push({
                    position: markPosition,
                    display: inchesToDisplay(markPosition, 'cut')
                });
            }
            
            // Create visual results
            const cutResults = document.createElement('div');
            cutResults.className = 'cut-results';
            
            const kerfNote = kerfEnabled ? ` (${inchesToDisplay(kerf, 'cut')} kerf)` : ' (no kerf)';
            const cutSideNote = kerfEnabled ? `, ${cutSide} side` : '';
            
            cutResults.innerHTML = `
                <h4>Cut ${inchesToDisplay(cutValueInches, 'cut')} into ${pieces} equal pieces${kerfNote}${cutSideNote}</h4>
                <div class="mark-list">
                    ${results.map((result, i) => `
                        <div class="mark-item">
                            <span class="mark-number">Mark ${i + 1}:</span>
                            <span class="mark-value">${result.display}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="piece-info">
                    Result: ${pieces} pieces @ ${inchesToDisplay(pieceLength, 'cut')} each
                </div>
            `;
            
            // Add to history
            const historyDiv = document.getElementById('cutHistory');
            if (historyDiv) {
                historyDiv.insertBefore(cutResults, historyDiv.firstChild);
                
                // Keep only last 5 results
                while (historyDiv.children.length > 5) {
                    historyDiv.removeChild(historyDiv.lastChild);
                }
            }
        }
        
        function customCut() {
            const pieces = parseInt(document.getElementById('customPieces')?.value);
            if (!pieces || pieces < 2 || pieces > 20) {
                showNotification('Please enter a number between 2 and 20');
                return;
            }
            quickCut(pieces);
            document.getElementById('customPieces').value = '';
        }
        
        function toggleKerfDisplay() {
            const cutKerfEnabled = document.getElementById('cutKerfEnabled')?.checked;
            const optKerfEnabled = document.getElementById('optKerfEnabled')?.checked;
            
            const cutKerfRow = document.getElementById('cutKerfRow');
            const optKerfRow = document.getElementById('optKerfRow');
            
            if (cutKerfRow) {
                cutKerfRow.style.display = cutKerfEnabled ? 'flex' : 'none';
            }
            if (optKerfRow) {
                optKerfRow.style.display = optKerfEnabled ? 'flex' : 'none';
            }
            
            updateKerfDiagram();
        }
        
        function updateKerfDiagram() {
            const kerfEnabled = document.getElementById('cutKerfEnabled')?.checked;
            const cutSide = document.getElementById('cutSide')?.value || 'right';
            const diagram = document.getElementById('kerfDiagram');
            const kerfArea = document.getElementById('kerfArea');
            
            if (diagram) {
                diagram.style.display = kerfEnabled ? 'flex' : 'none';
                if (kerfArea) {
                    kerfArea.className = 'kerf-area ' + cutSide;
                }
            }
        }
        
        function operation(op) {
            // Clear previous operation highlighting
            document.querySelectorAll('.btn-operation').forEach(btn => btn.classList.remove('active'));
            
            currentOperation = op;
            
            // Highlight the selected operation
            event.target.classList.add('active');
            
            if (inputMode === 'decimal') {
                document.getElementById('operationValue')?.focus();
            }
        }
        
        function executeOperation() {
            if (currentValueInches <= 0) {
                showNotification('Please set a measurement first');
                return;
            }
            
            if (!currentOperation) {
                showNotification('Please select an operation first');
                return;
            }
            
            const value = getOperationValue();
            if (value <= 0 && currentOperation === '/') {
                showNotification('Cannot divide by zero or negative number');
                return;
            }
            
            const oldValue = currentValueInches;
            let newValue;
            
            switch (currentOperation) {
                case '+':
                    newValue = currentValueInches + value;
                    break;
                case '-':
                    newValue = currentValueInches - value;
                    break;
                case '*':
                    newValue = currentValueInches * value;
                    break;
                case '/':
                    newValue = currentValueInches / value;
                    break;
            }
            
            currentValueInches = newValue;
            document.getElementById('currentValue').textContent = inchesToDisplay(currentValueInches);
            
            const valueDisplay = inputMode === 'fraction' ? inchesToDisplay(value) : value + '"';
            addHistory(`${inchesToDisplay(oldValue)} ${currentOperation} ${valueDisplay} = ${inchesToDisplay(newValue)}`);
            
            // Clear operation selection and highlighting
            currentOperation = null;
            document.querySelectorAll('.btn-operation').forEach(btn => btn.classList.remove('active'));
            clearOperationInputs();
        }
        
        function clearOperationInputs() {
            if (document.getElementById('opFeet')) document.getElementById('opFeet').value = '';
            if (document.getElementById('opInches')) document.getElementById('opInches').value = '';
            if (document.getElementById('opFraction')) document.getElementById('opFraction').value = '0';
            if (document.getElementById('operationValue')) document.getElementById('operationValue').value = '';
        }
        
        function addHistory(item) {
            history.unshift(item);
            if (history.length > 20) history.pop();
            
            const historyDiv = document.getElementById('history');
            if (historyDiv) {
                historyDiv.innerHTML = history.map(h => `<div class="history-item">${h}</div>`).join('');
            }
        }
        
        function addCutHistory(item) {
            cutHistory.unshift(item);
            if (cutHistory.length > 20) cutHistory.pop();
            
            const historyDiv = document.getElementById('cutHistory');
            if (historyDiv) {
                historyDiv.innerHTML = cutHistory.map(h => `<div class="history-item">${h}</div>`).join('');
            }
        }
        
        function clearAll() {
            currentValueInches = 0;
            currentOperation = null;
            if (document.getElementById('currentValue')) document.getElementById('currentValue').textContent = 'Enter measurement above';
            if (document.getElementById('feet')) document.getElementById('feet').value = '';
            if (document.getElementById('inches')) document.getElementById('inches').value = '';
            if (document.getElementById('fraction')) document.getElementById('fraction').value = '0';
            clearOperationInputs();
        }
        
        function clearCut() {
            cutValueInches = 0;
            if (document.getElementById('cutCurrentValue')) document.getElementById('cutCurrentValue').textContent = 'Enter measurement above';
            if (document.getElementById('cutFeet')) document.getElementById('cutFeet').value = '';
            if (document.getElementById('cutInches')) document.getElementById('cutInches').value = '';
            if (document.getElementById('cutFraction')) document.getElementById('cutFraction').value = '0';
            if (document.getElementById('cutHistory')) document.getElementById('cutHistory').innerHTML = '';
        }
        
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (event && event.target) event.target.classList.add('active');
            const targetTab = document.getElementById(tab);
            if (targetTab) targetTab.classList.add('active');
        }
        
        function showHelp() {
            const modal = document.getElementById('helpModal');
            if (modal) modal.style.display = 'block';
        }
        
        function closeHelp() {
            const modal = document.getElementById('helpModal');
            if (modal) modal.style.display = 'none';
        }
        
        // Edit modal functions
        function showEditModal(type, data) {
            editingItem = { type: type, data: data };
            const modal = document.getElementById('editModal');
            const title = document.getElementById('editTitle');
            const inputs = document.getElementById('editInputs');
            
            if (type === 'board') {
                title.textContent = 'Edit Board';
                const parts = inchesToParts(data.length);
                inputs.innerHTML = `
                    <div class="input-group">
                        <label>Length:</label>
                        <input type="number" id="editFeet" placeholder="0" min="0" class="wide-input" value="${parts.feet}">
                        <span>ft</span>
                        <input type="number" id="editInches" placeholder="0" min="0" max="11" class="wide-input" value="${parts.inches}">
                        <span>in</span>
                        <select id="editFraction" style="width: 120px;">
                            <option value="0">0</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Quantity:</label>
                        <input type="number" id="editQuantity" placeholder="1" min="0" class="wide-input" value="${data.quantity}">
                    </div>
                `;
                updatePrecision('optimizer'); // Update fraction options with optimizer precision
                setTimeout(() => {
                    if (document.getElementById('editFraction')) {
                        document.getElementById('editFraction').value = parts.fraction;
                    }
                }, 10);
            } else if (type === 'cutGroup') {
                title.textContent = 'Edit Cut Group';
                const parts = inchesToParts(data.length);
                inputs.innerHTML = `
                    <div class="input-group">
                        <label>Length:</label>
                        <input type="number" id="editFeet" placeholder="0" min="0" class="wide-input" value="${parts.feet}">
                        <span>ft</span>
                        <input type="number" id="editInches" placeholder="0" min="0" max="11" class="wide-input" value="${parts.inches}">
                        <span>in</span>
                        <select id="editFraction" style="width: 120px;">
                            <option value="0">0</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Quantity:</label>
                        <input type="number" id="editQuantity" placeholder="1" min="0" class="wide-input" value="${data.count}">
                    </div>
                `;
                updatePrecision(); // Update fraction options
                document.getElementById('editFraction').value = parts.fraction;
            }
            
            modal.style.display = 'block';
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingItem = null;
        }
        
        function saveEdit() {
            if (!editingItem) return;
            
            const newLength = getInputInches('editFeet', 'editInches', 'editFraction');
            const newQuantity = parseInt(document.getElementById('editQuantity')?.value) || 0;
            
            if (newLength <= 0) {
                showNotification('Please enter a valid length');
                return;
            }
            
            if (editingItem.type === 'board') {
                const index = editingItem.data.index;
                if (newQuantity > 0) {
                    boards[index] = { length: newLength, quantity: newQuantity };
                } else {
                    boards.splice(index, 1);
                }
                updateBoardsList();
            } else if (editingItem.type === 'cutGroup') {
                // Remove old cuts
                cuts = cuts.filter(cut => cut.id === undefined || !editingItem.data.ids.includes(cut.id));
                
                // Add new cuts
                for (let i = 0; i < newQuantity; i++) {
                    cuts.push({ length: newLength, id: cutIdCounter++ });
                }
                updateCutsList();
            }
            
            closeEditModal();
        }
        
        function deleteEdit() {
            if (!editingItem) return;
            
            if (confirm('Are you sure you want to delete this item?')) {
                if (editingItem.type === 'board') {
                    boards.splice(editingItem.data.index, 1);
                    updateBoardsList();
                } else if (editingItem.type === 'cutGroup') {
                    cuts = cuts.filter(cut => cut.id === undefined || !editingItem.data.ids.includes(cut.id));
                    updateCutsList();
                }
                closeEditModal();
            }
        }
        
        function editBoard(index) {
            showEditModal('board', { ...boards[index], index: index });
        }
        
        function editCutGroup(length, ids) {
            showEditModal('cutGroup', { length: length, count: ids.length, ids: ids });
        }
        
        function addBoard() {
            const inches = getInputInches('boardFeet', 'boardInches', 'boardFraction');
            const quantity = parseInt(document.getElementById('boardQuantity')?.value) || 1;
            if (inches <= 0) return;
            
            // Check if this board size already exists
            const existingBoard = boards.find(board => Math.abs(board.length - inches) < 0.01);
            if (existingBoard) {
                existingBoard.quantity += quantity;
            } else {
                boards.push({ length: inches, quantity: quantity });
            }
            
            updateBoardsList();
            
            if (document.getElementById('boardFeet')) document.getElementById('boardFeet').value = '';
            if (document.getElementById('boardInches')) document.getElementById('boardInches').value = '';
            if (document.getElementById('boardFraction')) document.getElementById('boardFraction').value = '0';
            if (document.getElementById('boardQuantity')) document.getElementById('boardQuantity').value = '1';
        }
        
        function addCut() {
            const inches = getInputInches('optCutFeet', 'optCutInches', 'optCutFraction');
            const quantity = parseInt(document.getElementById('cutQuantity')?.value) || 1;
            if (inches <= 0) return;
            
            for (let i = 0; i < quantity; i++) {
                cuts.push({ length: inches, id: cutIdCounter++ });
            }
            updateCutsList();
            
            if (document.getElementById('optCutFeet')) document.getElementById('optCutFeet').value = '';
            if (document.getElementById('optCutInches')) document.getElementById('optCutInches').value = '';
            if (document.getElementById('optCutFraction')) document.getElementById('optCutFraction').value = '0';
            if (document.getElementById('cutQuantity')) document.getElementById('cutQuantity').value = '1';
        }
        
        function updateBoardsList() {
            const div = document.getElementById('boardsList');
            if (!div) return;
            
            div.innerHTML = boards.map((board, i) => 
                `<div style="padding: 8px; background: #f0f0f0; margin: 4px; border-radius: 5px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="flex: 1;">
                        <strong>${board.quantity}× ${inchesToDisplay(board.length, 'opt')} boards</strong>
                    </div>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <button onclick="editBoard(${i})" style="background: #8B4513; color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer; font-size: 12px;">Edit</button>
                        <button onclick="removeBoard(${i})" style="background: #cd5c5c; color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer;">×</button>
                    </div>
                </div>`
            ).join('');
        }
        
        function updateCutsList() {
            const div = document.getElementById('cutsList');
            if (!div) return;
            
            const cutGroups = {};
            cuts.forEach(cut => {
                const lengthKey = cut.length.toFixed(6); // Use fixed precision for grouping
                if (!cutGroups[lengthKey]) {
                    cutGroups[lengthKey] = { length: cut.length, count: 0, ids: [] };
                }
                cutGroups[lengthKey].count++;
                cutGroups[lengthKey].ids.push(cut.id);
            });
            
            div.innerHTML = Object.values(cutGroups).map(group => 
                `<div style="padding: 8px; background: #f0f0f0; margin: 4px; border-radius: 5px; display: flex; align-items: center; justify-content: space-between;">
                    <div style="flex: 1;">
                        <strong>${group.count}× ${inchesToDisplay(group.length, 'opt')}</strong>
                    </div>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <button onclick="editCutGroup(${group.length}, [${group.ids.join(',')}])" style="background: #8B4513; color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer; font-size: 12px;">Edit</button>
                        <button onclick="removeCutGroup(${group.length})" style="background: #cd5c5c; color: white; border: none; border-radius: 3px; padding: 4px 8px; cursor: pointer;">×</button>
                    </div>
                </div>`
            ).join('');
        }
        
        function removeBoard(index) {
            boards.splice(index, 1);
            updateBoardsList();
        }
        
        function removeCutGroup(length) {
            // Remove all cuts that match this length (within small tolerance)
            cuts = cuts.filter(cut => Math.abs(cut.length - length) > 0.0001);
            updateCutsList();
        }
        
        function optimizeCuts() {
            if (boards.length === 0 || cuts.length === 0) {
                showNotification('Please add boards and cuts first');
                return;
            }
            
            const kerfEnabled = document.getElementById('optKerfEnabled')?.checked;
            const kerf = kerfEnabled ? parseFloat(document.getElementById('optKerf')?.value || 0.125) : 0;
            
            // Create expanded board list with individual boards
            let availableBoards = [];
            boards.forEach((boardType, typeIndex) => {
                for (let i = 0; i < boardType.quantity; i++) {
                    availableBoards.push({
                        length: boardType.length,
                        typeIndex: typeIndex,
                        boardNumber: i + 1
                    });
                }
            });
            
            const results = [];
            const remainingCuts = cuts.map(c => c.length).sort((a, b) => b - a); // Sort largest first
            availableBoards.sort((a, b) => b.length - a.length); // Sort by length desc
            
            let totalCutsCompleted = 0;
            
            for (let boardIndex = 0; boardIndex < availableBoards.length; boardIndex++) {
                let board = availableBoards[boardIndex];
                let boardLength = board.length;
                let cutsOnThisBoard = [];
                let usedLength = 0;
                
                for (let cutIndex = remainingCuts.length - 1; cutIndex >= 0; cutIndex--) {
                    const cutLength = remainingCuts[cutIndex];
                    const neededLength = usedLength === 0 ? cutLength : cutLength + kerf;
                    
                    if (usedLength + neededLength <= boardLength) {
                        cutsOnThisBoard.push(cutLength);
                        usedLength += neededLength;
                        remainingCuts.splice(cutIndex, 1);
                        totalCutsCompleted++;
                    }
                }
                
                if (cutsOnThisBoard.length > 0) {
                    const waste = boardLength - usedLength;
                    const boardSize = inchesToDisplay(board.length, 'opt');
                    results.push({
                        boardDisplay: `${boardSize} board #${board.boardNumber}`,
                        boardLength: board.length,
                        cuts: cutsOnThisBoard,
                        waste: waste
                    });
                }
                
                if (remainingCuts.length === 0) break;
            }
            
            displayOptimizationResults(results, remainingCuts, kerfEnabled, totalCutsCompleted, cuts.length);
        }
        
        function displayOptimizationResults(results, remainingCuts, kerfEnabled, completedCuts, totalCuts) {
            const div = document.getElementById('optimizationResults');
            if (!div) return;
            
            const kerfNote = kerfEnabled ? ` (with kerf)` : ' (no kerf)';
            let html = '<div class="results">';
            
            // Summary section
            html += '<h3>Summary:</h3>';
            html += `<p><strong>Cuts completed:</strong> ${completedCuts} of ${totalCuts}</p>`;
            
            if (remainingCuts.length > 0) {
                html += `<p style="color: #CD5C5C;"><strong>⚠️ Not enough boards!</strong> ${remainingCuts.length} cuts cannot be completed.</p>`;
            } else {
                html += `<p style="color: #4CAF50;"><strong>✅ All cuts can be completed!</strong></p>`;
            }
            
            if (results.length > 0) {
                html += `<h3 style="margin-top: 20px;">Cutting Plan${kerfNote}:</h3>`;
                results.forEach((result, index) => {
                    html += `<div class="cut-plan">
                        <strong>${result.boardDisplay}:</strong><br>
                        Cuts: ${result.cuts.map(cut => inchesToDisplay(cut, 'opt')).join(', ')}<br>
                        Waste: ${inchesToDisplay(result.waste, 'opt')}
                    </div>`;
                });
                
                const totalWaste = results.reduce((sum, result) => sum + result.waste, 0);
                html += `<p><strong>Total Waste: ${inchesToDisplay(totalWaste, 'opt')}</strong></p>`;
            }
            
            if (remainingCuts.length > 0) {
                html += '<h3 style="color: red; margin-top: 20px;">Cuts that don\'t fit:</h3>';
                const cutGroups = {};
                remainingCuts.forEach(cut => {
                    const display = inchesToDisplay(cut, 'opt');
                    cutGroups[display] = (cutGroups[display] || 0) + 1;
                });
                
                html += '<div style="background: #ffe6e6; padding: 10px; border-radius: 5px; border-left: 4px solid #CD5C5C;">';
                html += Object.entries(cutGroups).map(([display, count]) => 
                    `${count}× ${display}`
                ).join(', ');
                html += '<br><br><strong>Suggestion:</strong> Add more boards or reduce the number of cuts needed.';
                html += '</div>';
            }
            
            html += '</div>';
            div.innerHTML = html;
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const helpModal = document.getElementById('helpModal');
            const editModal = document.getElementById('editModal');
            const calcModal = document.getElementById('calcModal');
            if (event.target === helpModal) {
                helpModal.style.display = 'none';
            }
            if (event.target === editModal) {
                editModal.style.display = 'none';
                editingItem = null;
            }
            if (event.target === calcModal) {
                calcModal.style.display = 'none';
                currentModalCalc = null;
            }
        }
        
        // Initialize all precisions
        updatePrecision('calculator');
        updatePrecision('cut');
        updatePrecision('optimizer');
        toggleKerfDisplay();
    </script>
</body>
</html>
